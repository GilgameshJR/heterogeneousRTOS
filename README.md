# HeterogeneousRTOS
This repository contains the source code for HeterogeneousRTOS, a fork of FreeRTOS which features the integration of a fault detector and a real-time scheduler on FPGA for performance and fault resiliency purpose. The project is born as @francesco-ratti Master's thesis, @federeghe co-advisor. Subsequently evolved in a paper to-be published.

The project is meant to be executed on HeterogeneousRTOS hardware platform which can be found at the following link: [HeterogeneousRTOS Vivado Platform](https://github.com/francesco-ratti/heterogeneousRTOS_HW)

A Vitis platform has to be created (please refer to “Adding a FreeRTOS Domain” in this guide [Vitis User Guide: Adding a Standalone Domain](https://docs.amd.com/r/2021.1-English/ug1400-vitis-embedded/Adding-a-Standalone-Domain)), then create an application based on such platform (please refer to “Create an application project” in this guide [Vitis User Guide: Create an Application Project](https://docs.amd.com/r/2021.1-English/ug1393-vitis-application-acceleration/Create-an-Application-Project))

As soon as the first build is completed, please find in the platform folder the FreeRTOS source code and replace it with HeterogeneousRTOS source code (this repository).

<h3>Rationale:</h3>
Ionizing particles in the atmosphere may strike registers and memory cells causing Single Event Upsets (SEU), temporarily tampering the output correctness. SEUs could be dangerous for critical systems, in which a fault could lead to unacceptable consequences. Critical systems are traditionally custom-designed, typically featuring hardware redundancy for guaranteeing fault resilience. Additionally, they are often real-time, requiring to meet strict timing constraints. The downsides of such custom systems are typically weight, power, energy, space, and cost, compared to Commercial Off-the-Shelf (COTS) solutions. In this research, we explored the use of COTS in critical real-time environments by designing a CPU-FPGA heterogeneous system, which features an ARM CPU, running a modified version of FreeRTOS, a real-time operating system, and an FPGA, on which the fault-detector and the scheduler are synthesized, in a redundant configuration for increasing fault resiliency. Moving the scheduler to the FPGA increases its fault resiliency while removing the periodic scheduler execution overhead from the CPU, making the scheduler overhead negligible and allowing for an elevated time resolution: the tasks can almost completely utilise the CPU time.
Similarly, synthesizing the fault detector on the FPGA allows the execution of the fault detection in a fault-tolerant way without wasting CPU time. Transient fault resiliency in application tasks is achieved via fault detection and the subsequent fault recovery via re-execution. The fault detector implemented on FPGA uses a machine learning technique to learn the behaviour of tasks (offline and possibly online) and analyses it during their execution. Regarding fault recovery, the scheduler on the FPGA features a novel mixed-criticality scheduling algorithm that manages re-executions, ensuring the meeting of tasks' timing constraints. The fault detection showed noticeable results while providing a lower overhead than general-purpose software techniques for improving fault resiliency. To the best of our knowledge, the integrated CPU-FPGA version of the system, featuring fault tolerance and real-time scheduling, is a novel contribution that may enable the use of low-cost and fast COTS components in critical real-time environments.

<h3>Related repositories:</h3>

[HeterogeneousRTOS Vivado Platform](https://github.com/francesco-ratti/heterogeneousRTOS_HW)\
[Fault Detector Vitis HLS Project](https://github.com/francesco-ratti/heterogeneousRTOS_faultDetector_HLS)\
[Benchmarks source code and experimental evaluation artifacts](https://github.com/francesco-ratti/heterogeneousRTOS_benchmarks)\
[Data processing and analysis scripts](https://github.com/francesco-ratti/heteregeneousRTOS_benchmarks_data_analysis_scripts)
